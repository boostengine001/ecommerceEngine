
{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product available for purchase in the BlueCart store.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "category": {
          "type": "string",
          "description": "Category the product belongs to."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "imageUrl",
        "price",
        "category"
      ]
    },
    "CartItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CartItem",
      "type": "object",
      "description": "Represents an item in the shopping cart.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the cart item."
        },
        "productId": {
          "type": "string",
          "description": "Reference to the Product. (Relationship: Product 1:N CartItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the cart."
        },
        "cartId": {
          "type": "string",
          "description": "Reference to the Cart. (Relationship: Cart 1:N CartItem)"
        }
      },
      "required": [
        "id",
        "productId",
        "quantity",
        "cartId"
      ]
    },
    "Cart": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Cart",
      "type": "object",
      "description": "Represents the user's shopping cart.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the cart."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the UserProfile. (Relationship: UserProfile 1:1 Cart)"
        }
      },
      "required": [
        "id",
        "userId"
      ]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "shippingAddress": {
          "type": "string",
          "description": "User's shipping address."
        },
        "billingAddress": {
          "type": "string",
          "description": "User's billing address."
        },
        "roleId": {
            "type": "string",
            "description": "Reference to the AdminRole. (Relationship: AdminRole 1:N UserProfile)"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the UserProfile. (Relationship: UserProfile 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "shippingAddress": {
          "type": "string",
          "description": "Shipping address for the order."
        },
        "billingAddress": {
          "type": "string",
          "description": "Billing address for the order."
        },
        "orderItemIds": {
          "type": "array",
          "description": "References to OrderItems. (Relationship: Order 1:N OrderItem)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "orderDate",
        "totalAmount",
        "shippingAddress",
        "billingAddress"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "productId": {
          "type": "string",
          "description": "Reference to the Product. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the order."
        },
        "price": {
          "type": "number",
          "description": "Price of the product at the time of order."
        }
      },
      "required": [
        "id",
        "productId",
        "quantity",
        "price"
      ]
    },
     "AdminRole": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AdminRole",
      "type": "object",
      "description": "Represents a role for an admin user, defining their permissions.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the admin role."
        },
        "name": {
          "type": "string",
          "description": "Name of the role (e.g., 'Super Admin', 'Product Manager')."
        },
        "description": {
          "type": "string",
          "description": "A short description of the role's responsibilities."
        },
        "permissions": {
          "type": "array",
          "description": "A list of permission strings that define what the role can do.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": ["id", "name", "permissions"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information. All products have the same security posture, allowing for simple rules. Supports QAPs for product listings.",
          "params": [
            {
              "name": "productId",
              "description": "Unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
       {
        "path": "/roles/{roleId}",
        "definition": {
          "entityName": "AdminRole",
          "schema": {
            "$ref": "#/backend/entities/AdminRole"
          },
          "description": "Stores admin role definitions and their associated permissions.",
          "params": [
            {
              "name": "roleId",
              "description": "Unique identifier for the role."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cart",
        "definition": {
          "entityName": "Cart",
          "schema": {
            "$ref": "#/backend/entities/Cart"
          },
          "description": "Stores the user's shopping cart. CartId is same as userId. This path establishes clear ownership, avoiding the need for `get()` calls in rules.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user; same as the cart ID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/cart/cartItems/{cartItemId}",
        "definition": {
          "entityName": "CartItem",
          "schema": {
            "$ref": "#/backend/entities/CartItem"
          },
          "description": "Stores items in the user's shopping cart. This path establishes clear ownership, avoiding the need for `get()` calls in rules.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "cartItemId",
              "description": "Unique identifier for the cart item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores user order information. This path establishes clear ownership, avoiding the need for `get()` calls in rules.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}/orderItems/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores individual items within a user's order.  This path establishes clear ownership, avoiding the need for `get()` calls in rules.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "Unique identifier for the order."
            },
            {
              "name": "orderItemId",
              "description": "Unique identifier for the order item."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support BlueCart's eCommerce features while adhering to the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. It leverages structural segregation and access modeling to ensure secure and scalable data management.\n\n**Authorization Independence:**\n\n*   User-owned data (Carts, Orders) is nested under `/users/{userId}` to establish clear ownership without needing `get()` calls in security rules.\n\n**Structural Segregation:**\n\n*   Products are stored in a top-level `/products` collection, separate from user-specific data. This segregation simplifies security rules since all products share the same access requirements.\n* Roles are stored in a top-level `/roles` collection, allowing for centralized management of permissions.\n\n**Access Modeling:**\n\n*   User profiles are stored in `/users/{userId}`. Carts and Orders are subcollections under `/users/{userId}`, reflecting a clear ownership hierarchy. A user's role is stored as a reference on their profile.\n\n**QAPs (Rules are not Filters):**\n\n*   Products are in their own collection, `/products`, allowing secure listing of products without exposing private user data. Security rules can allow read access to all documents in the `/products` collection, fulfilling the QAP requirement for product listings.\n\nThis structure promotes simple, robust, and easily debuggable security rules by:\n\n*   Avoiding hierarchical authorization dependencies (no `get()` calls).\n*   Making authorization intent explicit through path-based ownership.\n*   Supporting atomic operations (transactions/batches) by eliminating the need to fetch parent data for authorization.\n*   Enabling secure list operations through structural segregation."
  }
}
